<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="node_modules/semantic-ui-css/semantic.min.css">
    <link rel="stylesheet" href="css/myCustom.css">
    <link rel="stylesheet" href="css/singUpForm.css">
    <link rel="stylesheet" href="css/animate.css">
    <script
      src="https://code.jquery.com/jquery-3.1.1.min.js"
      integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
      crossorigin="anonymous"></script>

    <script src="node_modules/semantic-ui-css/semantic.min.js"></script>
    <link rel="icon" type="image/png" href="images/place-finder.png">
    <title>PerF</title>
  </head>
  <body>

    <div class="ui massive blue menu">
      <a >
          <img class="ui mini image" style="left: 550%;top:5px;" src="images/place-finder.png">
      </a>
      <a>
        <img class="ui medium image" style="left: 70%;" src="images/logo.png">
      </a>
      <div id="signup">
        <button class="ui inverted blue button" onclick="document.getElementById('signUphomePage').style.display='block'">Sign up</button>
      </div>
      <div id="login">
        <button class="ui inverted blue button" onclick="document.getElementById('logInhomePage').style.display='block'">Log in</button>
      </div>
    </div>

    <div style="margin-top:200px;">
    <center>
      <h1 style="font-size:70px;font-weight:bolder;color: #fff;line-height: 1;">Get your perfect place </h1>
      <br></br>
      <div id="myInput" class="ui massive left icon input" style="width:35%;">
        <i class="marker icon"></i>
        <input id="chosenCity" name="chosenCity" placeholder="City" type="text" formaction="checkCity()" style="width:75%;">
  <!--      <form method="get" action="./searchCity.html"> -->
          <button  class=" ui large  black button" onclick="checkCity()" type="submit" style="width:50%;"><span>Let's Go   </span><span><i class="ui large search icon"></i></span> </button>
  <!--      </form>-->
      </div>


    </center>

    <div class="modal" id="logInStatus-homePage">
      <div class="modal-content animate" action="./searchCity.html" style="width:30%;">
        <form class="ui form">
          <h2>Successfully logged in</h2>
        </form>
      </div>
    </div>

    <div class="modal" id="logInStatusFailed-homePage">
      <div class="modal-content animate" action="./searchCity.html" style="width:30%;">
        <form class="ui form">
          <h2>Incorrect email</h2>
        </form>
      </div>
    </div>

<div id="logInhomePage" class="modal">
  <span onclick="document.getElementById('logInhomePage').style.display='none'" class="close" title="Close Modal">×</span>
  <div class="modal-content animate"  style="width:30%;">
    <div class="container">
      <h4 class="ui dividing header">Log in</h4>
      <div class="field" style="width:100%;">
        <div id="errorMessageContainer-homePage" style="display:none;">
          <ul>
            <li id="errorMessage-homePage"></li>
          </ul>
        </div>
        <label>Email</label>
        <div id="email-input-login-homePage" class="ui fluid input">
          <input class="ui input" id="email-login-homePage" name="email" placeholder="Email" type="text">
        </div>
      </div>
      <br>

      <div class="field" style="width:100%;">
        <label>Password</label>
        <div id="password-input-login-homePage" class="ui fluid input">
          <input class="ui input" id="password-login-homePage" name="password-homePage" placeholder="Password" type="text">
        </div>
      </div>
      <br>
      <button class="ui fluid blue button" type="submit" value="Submit" onclick="logInPOSThomePage()">Log in</button>
    </div>
  </div>
</div>

      <div class="modal" id="signInStatus-homePage">
        <div class="modal-content animate" action="./searchCity.html" style="width:30%;">
          <form class="ui form">
            <h2>Successfully signed in</h2>
          </form>
        </div>
      </div>

      <div class="modal" id="signInStatusFailed-homePage">
        <div class="modal-content animate" action="./searchCity.html" style="width:30%;">
          <form class="ui form">
            <h2>Email already existent in data base</h2>
          </form>
        </div>
      </div>


  <div id="signUphomePage" class="modal">
    <span onclick="document.getElementById('signUphomePage').style.display='none'" class="close" title="Close Modal">×</span>
    <div class="modal-content animate"  style="width:30%;">
      <div class="container">
        <h4 class="ui dividing header">Sign up</h4>
        <div class="field" style="width:100%;">
          <div id="errorMessageContainer-homePage" style="display:none;">
            <ul>
              <li id="errorMessage-homePage"></li>
            </ul>
          </div>
          <label>First Name</label>
          <div id="first-name-input-homePage" class="ui fluid input">
            <input  id="first-name-homePage" name="first-name-homePage" placeholder="First Name" type="text">
          </div>
        </div>

        <br>
        <div class="field" style="width:100%;">
          <label>Last Name</label>
          <div id="last-name-input-homePage" class="ui fluid input">
            <input id="last-name-homePage" name="last-name-homePage" placeholder="Last Name" type="text">
          </div>
        </div>
        <br>
        <div class="field" style="width:100%;">
          <label>Email</label>
          <div id="email-input-homePage" class="ui fluid input">
            <input class="ui input" id="email-homePage" name="email" placeholder="Email" type="text">
          </div>
        </div>
        <br>
        <div class="field" style="width:100%;">
          <label>Password</label>
          <div id="password-input-homePage" class="ui fluid input">
            <input class="ui input" id="passwordSignUp-homePage" name="password-homePage" placeholder="Password" type="text">
          </div>
        </div>
        <br>
        <button class="ui fluid blue button" type="submit" value="Submit" onclick="signUpPOSThomePage()">Sign Up</button>
      </div>
    </div>
  </div>

  <script>
var modalSignUpHomePage= document.getElementById('signUphomePage');
    // When the user clicks anywhere outside of the modal, close it
    var modalLoginHomePage = document.getElementById('logInhomePage');
    window.onclick = function(event) {
        if(event.target === modalSignUpHomePage )
        {
            modalSignUpHomePage.style.display = "none";
            $('#first-name-input-homePage').removeClass('error');
            $('#first-name-homePage').attr("placeholder","First name");
            $('#last-name-input-homePage').removeClass('error');
            $('#last-name-homePage').attr("placeholder","Last name");
            $('#email-input-homePage').removeClass('error');
            $('#email-homePage').attr("placeholder","Email");
            $('#password-input-homePage').removeClass('error');
            $('#password-name-homePage').attr("placeholder","Password");
            $('#errorMessageContainer-homePage').css("display", "none");
            $("#email-homePage").val("");
            $("#passwordSignUp-homePage").val("");
            $("#first-name-homePage").val("");
            $("#last-name-homePage").val("");
        }
        else {
          if (event.target == modalLoginHomePage)
          {
            modalLoginHomePage.style.display = "none";
            $('#email-input-login-homePage').removeClass('error');
            $('#email-login-homePage').attr("placeholder","Email");
            $('#password-input-login-homePage').removeClass('error');
            $('#errorMessageContainer-homePage').css("display", "none");
            $("#email-login-homePage").val("");
            $("#password-login-homePage").val("");
          }
          else
          {
                if (event.target === document.getElementById('signInStatus-homePage')) {
                     document.getElementById('signInStatus-homePage').style.display='none';
                } else {
                    if (event.target ===  document.getElementById('signInStatusFailed-homePage')){
                        document.getElementById('signInStatusFailed-homePage').style.display='none';
                    }
                }
          }
        }

    }


    var txt = document.getElementById('chosenCity');
    txt.addEventListener("keypress", function(event) {
      if (event.keyCode == 13)
          checkCity();
   });


    function checkCity(){
      var input = document.getElementById('chosenCity'),
        cityName = input.value;
    if (cityName == "Iasi" || cityName == "Bucuresti" || cityName == "New York" || cityName == "London") {
        window.location = "./searchCity.html?city=" + cityName;
        var cityInputValue = document.getElementById('chosenCity').value;
        document.getElementById('city').value = cityInputValue;
    } else {
        document.getElementsByName('chosenCity')[0].placeholder='Pleace specify a valid city';
        document.getElementById('chosenCity').value = null;
          console.log("I'll shake");
          $('#myInput').click(function(){
          $('#myInput').addClass('animated shake')
          .one('webkitAnimationEnd oAnimationEnd', function(){
              $('#myInput').removeClass('animated shake');
         });
        });
        document.getElementById('myInput').classList.remove("animated");
        document.getElementById('myInput').classList.remove("shake");
        console.log("removed");
      }
    }

//     $(document).ready(function(){
//         $.ajax({
//          url: "/user/register",
//          type: "GET",
//          data : {json: "hello" }, //in servlet use request.getParameters("json")
//          dataType : 'json',
//          success: function(data) {}, //data holds {success:true} - see below
//          error: errorFunction
//         });
//      })

var array = [ 1, 2, 3, 4 ];

	var json = JSON.stringify(array);


	//$.ajax({ url:"/",
    //      type:"POST",
    //      data: json,
    //      dataType:'json',
     //    success:function(data){
	//			$("#output").append( data );
			//	window.location = 'testArrFour.jsp';
	//		},
	//		error: function() {
	//			 $("#output").html("fail");
	//		}
	//});

	var data = new FormData();
    data.append('name', 'Bob');

    function sendData() {
    console.log("In sendData()");
        $.ajax({
            url: '/create/user',
            type: 'POST',
            contentType: false,
            data: data,
            dataType: 'json'
        });
    }

    function verifyData() {
    console.log("In verifyData()");
        $.ajax({
            url: '/verify/user',
            type: 'POST',
            contentType: false,
            data: data,
            dataType: 'json'
        });
    }

    function logInPOSThomePage() {
                  $('#password-input-login-homePage').removeClass('error');
                  $('#email-input-login-homePage').removeClass('error');
                  console.log('logInPOST');
                  var url = "/verify/user";
                  var method = "POST";
                  var passInput = document.getElementById('password-login-homePage');
                  var password = passInput.value;
                  var emailInput = document.getElementById('email-login-homePage');
                  var email = emailInput.value;
                  var isValid = true;
                  var atpos = email.indexOf("@");
                  var dotpos = email.lastIndexOf(".");
                  if (password === "") {
                        $('#password-input-login-homePage').addClass('error');
                        $('#password-login-homePage').attr("placeholder","Insert password");
                             $('#errorMessage-homePage').text("Insert password");
                             $('#errorMessageContainer-homePage').css("display", "block");
                        isValid = false;
                  }
                  if (email === "" || atpos<1 || dotpos<atpos+2 || dotpos+2>=email.length) {
                        $('#email-input-login-homePage').addClass('error');
                        $('#email-login-homePage').attr("placeholder","Insert email");
                            $('#errorMessage-homePage').text("Insert email");
                            $('#errorMessageContainer-homePage').css("display", "block");
                        isValid = false;
                  }
                  var postData = {
                       "password" : password,
                       "email" : email
                      };
                  if (isValid === true ){
                      var async = true;
                      var request = new XMLHttpRequest();
                      var status;
                      var data;
                      request.onload = function () {
                            status = request.status; // HTTP response status, e.g., 200 for "200 OK"
                            data = request.responseText; // Returned data, e.g., an HTML document.
                            if (data === 'incorrect') {
                                console.log ("incorrect EMAIL");
                                document.getElementById('logInhomePage').style.display='none';
                                document.getElementById('logInStatusFailed-homePage').style.display='block';
                            } else {
                              document.getElementById('logInhomePage').style.display='none';
                              document.getElementById('logInStatus-homePage').style.display='block';
                          }
                      }
                      request.open(method, url,true);
                      request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                      request.send(JSON.stringify(postData));
                      document.getElementById('logInhomePage').style.display='none';
                      $("#email-login-homePage").val("");
                      $("#password-login-homePage").val("");
                  }
           }

    function signUpPOSThomePage() {
                  $('#password-input-homePage').removeClass('error');
                  $('#first-name-input-homePage').removeClass('error');
                  $('#last-name-input-homePage').removeClass('error');
                  $('#email-input-homePage').removeClass('error');
                  console.log('signUpPOST');
                  var url = "/create/user";
                  var method = "POST";
                  var firstNameInput = document.getElementById('first-name-homePage');
                  var firstName = firstNameInput.value;
                  var lastNameInput = document.getElementById('last-name-homePage');
                  var lastName = lastNameInput.value;
                  var passInput = document.getElementById('passwordSignUp-homePage');
                  var password = passInput.value;
                  var emailInput = document.getElementById('email-homePage');
                  var email = emailInput.value;
                  var isValid = true;
                  var atpos = email.indexOf("@");
                  var dotpos = email.lastIndexOf(".");
                 if (firstName === "") {
                        $('#first-name-input-homePage').addClass('error');
                        $('#first-name-homePage').attr("placeholder","Insert first name");
                        $('#errorMessage-homePage').text("Insert first name");
                        $('#errorMessageContainer-homePage').css("display", "block");
                        isValid = false;
                  }
                  if (lastName === "") {
                        $('#last-name-input-homePage').addClass('error');
                        $('#last-name-homePage').attr("placeholder","Insert last name");
                            $('#errorMessage-homePage').text("Insert last name");
                            $('#errorMessageContainer-homePage').css("display", "block");

                        isValid = false;
                  }
                  if (password === "") {
                        $('#password-input-homePage').addClass('error');
                        $('#passwordSignUp-homePage').attr("placeholder","Insert password");
                             $('#errorMessage-homePage').text("Insert password");
                             $('#errorMessageContainer-homePage').css("display", "block");

                        isValid = false;
                  }
                  if (email === "" || atpos<1 || dotpos<atpos+2 || dotpos+2>=email.length) {
                        $('#email-input-homePage').addClass('error');
                        $('#email-homePage').attr("placeholder","Insert email");
                            $('#errorMessage-homePage').text("Insert email");
                            $('#errorMessageContainer-homePage').css("display", "block");

                        isValid = false;
                  }
                  var postData = {
                      "first-name": firstName,
                       "last-name" : lastName,
                       "password" : password,
                       "email" : email

                      };
                  if (isValid === true ){
                      var async = true;
                      var request = new XMLHttpRequest();
                      var status;
                      var data;
                      request.onload = function () {
                            status = request.status; // HTTP response status, e.g., 200 for "200 OK"
                            data = request.responseText; // Returned data, e.g., an HTML document.
                            if (data === 'DUPLICATE') {
                                console.log ("DUPLICATE EMAIL");
                                document.getElementById('signUphomePage').style.display='none';
                                document.getElementById('signInStatusFailed-homePage').style.display='block';
                            } else {
                              document.getElementById('signUphomePage').style.display='none';
                              document.getElementById('signInStatus-homePage').style.display='block';
                          }
                      }
                      request.open(method, url,true);
                      request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                      request.send(JSON.stringify(postData));
                      document.getElementById('signUphomePage').style.display='none';
                       $("#email-homePage").val("");
                       $("#passwordSignUp-homePage").val("");
                       $("#first-name-homePage").val("");
                       $("#last-name-homePage").val("");

                  }
           }

  </script>

  </div>
</body>
</html>
